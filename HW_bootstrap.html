<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="So You Think You Can Do Statistics" />


<title>Bootstrap (homework)</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistical Thinking</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="syllabus_SYTYCDS2020.html">Example Syllabus</a>
    </li>
    <li>
      <a href="exercises.html">Hands on Exercises</a>
    </li>
    <li>
      <a href="homework.html">Home work</a>
    </li>
    <li>
      <a href="lectures.html">Lectures</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Bootstrap (homework)</h1>
<h4 class="author">So You Think You Can Do Statistics</h4>

</div>


<pre class="r"><code># THIS DOCUMENT INCLUDES THE SOLUTION
# regenerate with soln: FALSE to create the 
# HW assignment for the students

# The point of this HW is to give the students practice
# creating bootstrap confidence intervals and to 
# provide an example where using the mean (and tdist based CI)
# probably doesn&#39;t make much sense.


# Here we simulate some data for use in the HW
# you will need to make this accessible to the students for
# this hw
set.seed(87)
incomes &lt;- exp(rnorm(1000,10.75,1.02))
incomesB &lt;- exp(rnorm(1000,10.75,0.85))
incomesSmall &lt;- sample(incomes,100)
# create an function gini to calculate the gini index
gini &lt;- function(x){
  n &lt;- length(x)
  mu &lt;- mean(x)
  2/(n*(n-1)*mu)*sum((1:n)*sort(x))-(n+1)/(n-1)
}
# save everything in an R object called incomes.Rdat
save(incomes,incomesB,incomesSmall,gini,file=&quot;incomes.Rdat&quot;)
# students can access this copying the file to somewhere
# they have access to and then typing load(file.choose())
# Or if they put it in their working directory they can
# use load(&quot;incomes.Rdat&quot;)

#remove the objects from the session.

rm(list=c(&quot;incomes&quot;,&quot;incomesB&quot;,&quot;incomesSmall&quot;,&quot;gini&quot;))</code></pre>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>In this homework you will be analyze income data using the bootstrap. In many cases we describe populations using the mean. For example, the mean monthly GB of data used in cell phone plans, or the mean length of hospital stays. As Peter showed in class, the central limit theorem allows us to easily construct approximate confidence intervals for the mean, <span class="math inline">\(\bar{x} \pm 1.96se\)</span>. But what do you do when you want to calculate a confidence interval for a metric that is not the mean? Below you will use the bootstrap to calculate confidence intervals for metrics commonly used when describing income distributions.</p>
<ol style="list-style-type: decimal">
<li><p>Download incomes.Rdat from the files section of the class site and move it into you R working directory. You can figure out what your R working directory is by typing getwd() and hitting return. Or you can change your working directory using the menu option <code>session/change working directory</code>in Rstudio. Once you have the file, load the income data into the R session using the <code>load</code> function.</p>
<pre class="r"><code>load(&quot;incomes.Rdat&quot;)</code></pre>
<p>You will now have the variables, <code>incomes</code>, <code>incomesB</code>, and <code>incomesSmall</code>, as well as a function called <code>gini</code> in your R session. The variables <code>incomes</code>, <code>incomesB</code>, and <code>incomesSmall</code> are random samples from all incomes in a country. There are 1000 values in <code>incomes</code> and <code>incomesB</code> while <code>incomesSmall</code> has 100 values. Plot a histogram of the <code>incomes</code> data (not <code>incomesB</code> or <code>incomesSmall</code>) and calculate some basic statistics (like the mean). What do you notice about the data?</p></li>
</ol>
<blockquote>
<p>Solution</p>
<pre class="r"><code>hist(incomes)</code></pre>
<p><img src="HW_bootstrap_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>mean(incomes)</code></pre>
<pre><code>## [1] 74106.03</code></pre>
<pre class="r"><code>median(incomes)</code></pre>
<pre><code>## [1] 45403.63</code></pre>
<pre class="r"><code>sd(incomes)</code></pre>
<pre><code>## [1] 94039.74</code></pre>
<p>The income distribution is not symmetric. It is skewed, with a long tail to the right. Also, notice that the median is much smaller than the mean. For a symetric distribution we would expect them to be similar. The median is the value for which 50% of the observations are above and 50% below.</p>
</blockquote>
<ol start="2" style="list-style-type: decimal">
<li><p>Income inequality is a topic that has recently received a lot of attention. One way to summarize the degree of income inequality is to calculate the proportion of total income that goes to the top 5% of earners (let's refer to this as the top5 metric). There are different ways that you could calculate this metric in R. One way is to a) figure out what income level separates the lower 95% from the top 5% of earners, b) sum the incomes above this level and then c) divide this sum by the sum of all incomes. For step a we can use the <code>quantile</code> function in R.</p>
<pre class="r"><code>quantile(incomes,prob=0.95)</code></pre>
<p>To sum the incomes above a certain level (here we use x as a place holder) we can use:</p>
<pre class="r"><code>sum(incomes[incomes&gt;x])</code></pre>
<p>Calculate the proportion of the total income that goes to the top 5% of earners for sample <code>incomes</code>. What would you expect if everyone earned about the same income?</p></li>
</ol>
<blockquote>
<p>Solution</p>
<pre class="r"><code>Q95 &lt;- quantile(incomes,prob=0.95)
sum(incomes[incomes&gt;Q95])/sum(incomes)</code></pre>
<pre><code>## [1] 0.2521954</code></pre>
<p>So 25% of the total income goes to the top 5% of earners. If all incomes were about the same I would expect to get 5% instead.</p>
</blockquote>
<ol start="3" style="list-style-type: decimal">
<li>Since <code>incomes</code> is a sample from a population, we would like to describe the uncertainty in this estimate. Use the bootstrap to calculate a 95% confidence interval for the top5 metric (calculated in question 2, i.e. % of total income going to the top 5% of earners) and plot the histogram of the bootstrap distribution (again for the <code>incomes</code> data). Use 10,000 resamples in your bootstrap code. Notice: the <code>size</code> parameter in the <code>sample</code> function should be <code>1000</code> (the size of the sample, incomes). If you don't include the <code>size</code> parameter it defaults to the size of vector you are sampling from (so in this case, 1000).</li>
</ol>
<blockquote>
<p>Solution</p>
<pre class="r"><code>bsVals &lt;- numeric(10000)
incomeDat &lt;- incomes
for(i in 1:10000){
 incomeSamp &lt;- sample(incomeDat,replace=TRUE)
 top5break &lt;- quantile(incomeSamp,prob=0.95)
 bsVals[i] &lt;- sum(incomeSamp[incomeSamp&gt;top5break])/sum(incomeSamp)
}
bsCI &lt;- quantile(bsVals,prob=c(0.025,0.975))
hist(bsVals,xlab=&quot;Proportion of total income that goes to the richest 5%&quot;,main=&quot;&quot;,col=&quot;gray&quot;)
top5break &lt;- quantile(incomeDat,prob=0.95)
pp &lt;- sum(incomeDat[incomeDat&gt;top5break])/sum(incomeDat)
abline(v=pp,lwd=2)
abline(v=bsCI[1],lty=3)
abline(v=bsCI[2],lty=3)</code></pre>
<p><img src="HW_bootstrap_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The 95% confidence interval is (0.219-0.283) .</p>
</blockquote>
<ol start="4" style="list-style-type: decimal">
<li><p>the incomesB variable contains a sample of incomes from another country. Calculate the 95% confidence interval for this population (using the same top5 metric as in problems 2 and 3). Do the confidence intervals overlap? Even if the confidence intervals do overlap, there could still be a statistically significant difference between the two metrics. Calculate the confidence interval for the difference in the metrics for the two populations. This can be accomplished using code very similar to what you have already used. Look at the solution to question 2 in the lab for an example of creating a bootstrap confidence interval for a difference between means (although here we are not using means). It should look something like this:</p>
<pre class="r"><code>for(i in 1:10000){
  # draw a sample from each population and calculate the two metrics
  bsVals[i] &lt;- valueForCountryA - valueForCountryB
}</code></pre>
<p>Is there a statistically significant difference?</p></li>
</ol>
<blockquote>
<p>Solution</p>
<pre class="r"><code>bsVals &lt;- numeric(10000)
incomeDat &lt;- incomesB
for(i in 1:10000){
 incomeSamp &lt;- sample(incomeDat,replace=TRUE)
 top5break &lt;- quantile(incomeSamp,prob=0.95)
 bsVals[i] &lt;- sum(incomeSamp[incomeSamp&gt;top5break])/sum(incomeSamp)
}
bsCIB &lt;- quantile(bsVals,prob=c(0.025,0.975))
# plot the results
hist(bsVals,xlab=&quot;Proportion of total income that goes to the richest 5%&quot;,main=&quot;&quot;,col=&quot;gray&quot;)
top5break &lt;- quantile(incomeDat,prob=0.95)
pp &lt;- sum(incomeDat[incomeDat&gt;top5break])/sum(incomeDat)
abline(v=pp,lwd=2)
abline(v=bsCIB[1],lty=3)
abline(v=bsCIB[2],lty=3)</code></pre>
<p><img src="HW_bootstrap_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The 95% confidence interval is (0.184-0.227). So, there is a slight overlap with the confidence interval for population A.</p>
<pre class="r"><code>bsVals &lt;- numeric(10000)
incomeDat &lt;- incomesB
for(i in 1:10000){
 incomeSampA &lt;- sample(incomes,replace=TRUE)
 top5breakA &lt;- quantile(incomeSampA,prob=0.95)
 valA &lt;- sum(incomeSampA[incomeSampA&gt;top5breakA])/sum(incomeSampA)
 incomeSampB &lt;- sample(incomesB,replace=TRUE)
 top5breakB &lt;- quantile(incomeSampB,prob=0.95)
 valB &lt;- sum(incomeSampB[incomeSampB&gt;top5breakB])/sum(incomeSampB)
 bsVals[i] &lt;- valA - valB
}
bsCI &lt;- quantile(bsVals,prob=c(0.025,0.975))
hist(bsVals,xlab=&quot;Proportion of total income that goes to the richest 5%&quot;,main=&quot;&quot;,col=&quot;gray&quot;)
top5breakA &lt;- quantile(incomes,prob=0.95)
ppA &lt;- sum(incomes[incomes&gt;top5breakA])/sum(incomes)
top5breakB &lt;- quantile(incomesB,prob=0.95)
ppB &lt;- sum(incomesB[incomesB&gt;top5breakB])/sum(incomesB)
abline(v=ppA-ppB,lwd=2)
abline(v=bsCI[1],lty=3)
abline(v=bsCI[2],lty=3)</code></pre>
<p><img src="HW_bootstrap_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>The confidence interval for the difference (0.008-0.084) does not include 0 so there is a statistically significant difference (barely!).</p>
</blockquote>
<ol start="5" style="list-style-type: decimal">
<li>The <a href="https://en.wikipedia.org/wiki/Gini_coefficient">Gini coefficient</a> is another way of measuring income inequality. Calculate a 90% CI for the difference in the gini coefficient for the two populations. Notice that the statement <code>gini(incomes)</code> will calculate the gini index for the <code>incomes</code> data.</li>
</ol>
<blockquote>
<p>Solution</p>
<pre class="r"><code>bsVals &lt;- numeric(10000)
incomeDat &lt;- incomesB
for(i in 1:10000){
 incomeSampA &lt;- sample(incomes,replace=TRUE)
 incomeSampB &lt;- sample(incomesB,replace=TRUE)
 bsVals[i] &lt;- gini(incomeSampA)-gini(incomeSampB)
}
bsCI &lt;- quantile(bsVals,prob=c(0.025,0.975))
hist(bsVals,xlab=&quot;Gini Coefficient&quot;,main=&quot;&quot;,col=&quot;gray&quot;)
pp &lt;- gini(incomes)-gini(incomesB)
abline(v=pp,lwd=2)
abline(v=bsCI[1],lty=3)
abline(v=bsCI[2],lty=3)</code></pre>
<p><img src="HW_bootstrap_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</blockquote>
<div id="extra-for-experts." class="section level4">
<h4>Extra for experts.</h4>
<ol start="6" style="list-style-type: decimal">
<li><p>The <a href="https://en.wikipedia.org/wiki/Lorenz_curve">Lorenz curve</a> shows the metric calculated in problem 2, but for all percentages (i.e. not just 5%). We can plot the curve for the much smaller sample of incomes,<code>incomesSmall</code>, data using the code:</p>
<pre class="r"><code>xx &lt;- 100*cumsum(sort(incomesSmall))/sum(incomesSmall)
plot(100*(1:length(xx))/length(xx),xx,xlab=&quot;Cummulative percent of earners from lowest to highest incomes&quot;,ylab=&quot;Cummulative percent of income earned&quot;,type=&quot;l&quot;,xaxs=&quot;i&quot;,yaxs=&quot;i&quot;)
abline(0,1,lty=3)</code></pre>
<p><img src="HW_bootstrap_files/figure-html/unnamed-chunk-12-1.png" width="576" /></p>
<p>Generate 20 or so bootstrap samples from <code>incomesSmall</code> and draw their Lorenz curves over the top of the plot above. For which x values does the uncertainty in the % income earned tend to be the highest (hint: draw a few vertical lines).</p></li>
</ol>
<blockquote>
<p>Solution</p>
<pre class="r"><code>xx &lt;- 100*cumsum(sort(incomesSmall))/sum(incomesSmall)
plot(100*(1:length(xx))/length(xx),xx,xlab=&quot;Cummulative percent of earners from lowest to highest incomes&quot;,ylab=&quot;Cummulative percent of income earned&quot;,type=&quot;l&quot;,xaxs=&quot;i&quot;,yaxs=&quot;i&quot;)
abline(0,1,lty=3)
for(i in 1:25){
 samp &lt;- sample(incomesSmall,replace=TRUE)
 xx &lt;- 100*cumsum(sort(samp))/sum(samp)
 lines(100*(1:length(xx))/length(xx),xx,col=rgb(0,0,0,0.2))
}</code></pre>
<p><img src="HW_bootstrap_files/figure-html/unnamed-chunk-13-1.png" width="576" /></p>
<p>There's more uncertainty for moderate and higher values of Cummulative percent of earners.</p>
</blockquote>
</div>
</div>

<p></p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
